<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout - Aamoda Pickles</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/geolib/2.0.24/geolib.min.js"></script>
</head>

<body>
    <nav class="navbar navbar-expand-lg custom-navbar">
        <div class="container ">
            <a class="navbar-brand" href="#">
                <img src="logo.png" class="logo-image" alt="Aamoda Pickles Logo">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="bg">Menu</span>
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav m-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="veg.html">Veg Pickles</a></li>
                    <li class="nav-item"><a class="nav-link" href="nonveg.html">Non-Veg Pickles</a></li>
                    <li class="nav-item"><a class="nav-link" href="specials.html">Specials</a></li>
                    <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
                    <li class="nav-item">
                        <a class="nav-link" href="cart.html">
                            <i class="fas fa-shopping-cart"></i> Cart (<span id="cart-icon-count">0</span>)
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <header class="header text-center py-4">
        <h1>Checkout</h1>
    </header>

    <section class="checkout-section py-5 bg-light">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <h3>Shipping Information</h3>
                    <form id="checkout-form">
                        <div class="mb-3">
                            <label for="fullName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="fullName" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="mb-3">
                            <label for="phone" class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="phone" required>
                        </div>
                        <div class="mb-3">
                            <label for="address" class="form-label">Address</label>
                            <input type="text" class="form-control" id="address"
                                placeholder="Street Address, Apartment, Suite, etc." required>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="city" class="form-label">City</label>
                                <input type="text" class="form-control" id="city" required>
                            </div>
                            <div class="col-md-4 mb-3">
                              <label for="state" class="form-label">State</label>
                              <select class="form-control" id="state" required>
                                <option value="">Select State</option>
                                <option>Andhra Pradesh</option>
                                <option>Arunachal Pradesh</option>
                                <option>Assam</option>
                                <option>Bihar</option>
                                <option>Chhattisgarh</option>
                                <option>Goa</option>
                                <option>Gujarat</option>
                                <option>Haryana</option>
                                <option>Himachal Pradesh</option>
                                <option>Jharkhand</option>
                                <option>Karnataka</option>
                                <option>Kerala</option>
                                <option>Madhya Pradesh</option>
                                <option>Maharashtra</option>
                                <option>Manipur</option>
                                <option>Meghalaya</option>
                                <option>Mizoram</option>
                                <option>Nagaland</option>
                                <option>Odisha</option>
                                <option>Punjab</option>
                                <option>Rajasthan</option>
                                <option>Sikkim</option>
                                <option>Tamil Nadu</option>
                                <option>Telangana</option>
                                <option>Tripura</option>
                                <option>Uttar Pradesh</option>
                                <option>Uttarakhand</option>
                                <option>West Bengal</option>
                                <option>Andaman and Nicobar Islands</option>
                                <option>Chandigarh</option>
                                <option>Dadra and Nagar Haveli and Daman and Diu</option>
                                <option>Delhi</option>
                                <option>Jammu and Kashmir</option>
                                <option>Ladakh</option>
                                <option>Lakshadweep</option>
                                <option>Puducherry</option>
                              </select>
                            </div>
                            <div class="col-md-2 mb-3">
                                <label for="zip" class="form-label">Zip Code</label>
                                <input type="text" class="form-control" id="zip" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="country" class="form-label">Country</label>
                            <input type="text" class="form-control" id="country" value="India" readonly>
                        </div>

                        <h3 class="mt-4">Order Summary</h3>
                        <div id="order-summary-items" class="mb-3">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4>Subtotal: ₹<span id="order-subtotal">0</span></h4>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4>Shipping: ₹<span id="shipping-cost">0</span></h4>
                        </div>
                        <div class="text-end mb-4">
                            <h3>Total Amount: ₹<span id="order-total">0</span></h3>
                        </div>

                        <button type="submit" class="btn btn-success btn-lg w-100">Pay Now</button>
                    </form>
                </div>
                <div class="col-md-4">
                    <div class="card p-3 sticky-top" style="top: 20px;">
                        <h4 class="mb-3">Secure Payment</h4>
                        <p>Your payment will be processed securely using Razorpay.</p>
                        <p>Please review your order and shipping details before proceeding.</p>
                        <img src="razorpay.png" alt="Razorpay Placeholder" class="img-fluid mt-3">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="contact-section py-5 bg text-white">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-4 text-center mb-4 mb-md-0">
                    <img src="logo.png" class="img-fluid" style="max-height: 250px;" alt="Aamoda Pickles Logo">
                </div>
                <div class="col-md-8 text-center text-md-start">
                    <h2>Contact Us</h2>
                    <p>We'd love to hear from you! Connect with us through:</p>
                    <div class="d-flex flex-column flex-md-row justify-content-center justify-content-md-start gap-3">
                        <a href="https://wa.me/917731021234?text=Hi%2C%20I%27d%20like%20to%20place%20an%20order." target="_blank" rel="noopener noreferrer" class="btn btn-light btn-lg">
                            <i class="fab fa-whatsapp"></i> WhatsApp
                        </a>
                        <a href="mailto:support@aamodapickles.com" class="btn btn-light btn-lg">
                            <i class="fas fa-envelope"></i> Email
                        </a>
                        <a href="tel:+917731021234" class="btn btn-light btn-lg">
                            <i class="fas fa-phone"></i> Phone
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer py-3 text-center">
        &copy; 2025 Aamoda Pickles. All rights reserved.
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const cart = JSON.parse(localStorage.getItem('cartItems')) || [];
            const orderSummaryItems = document.getElementById('order-summary-items');
            const orderSubtotalElement = document.getElementById('order-subtotal');
            const shippingCostElement = document.getElementById('shipping-cost');
            const orderTotalElement = document.getElementById('order-total');
            const checkoutForm = document.getElementById('checkout-form');

            let totalWeight = 0; // in grams

            // Display cart items summary
            function displayCartItems() {
                orderSummaryItems.innerHTML = '';
                let subtotal = 0;
                totalWeight = 0;

                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    subtotal += itemTotal;
                    totalWeight += item.weight * item.quantity; // weight assumed in grams

                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'd-flex justify-content-between mb-2';
                    itemDiv.innerHTML = `
                        <div>${item.name} x ${item.quantity}</div>
                        <div>₹${itemTotal.toFixed(2)}</div>
                    `;
                    orderSummaryItems.appendChild(itemDiv);
                });

                orderSubtotalElement.textContent = subtotal.toFixed(2);
                return subtotal;
            }

            // Function to simulate distance calculation based on zip code or city/state
            function calculateDistance() {
                // For demo: use simple mock distances for some zip codes or states
                const zip = document.getElementById('zip').value.trim();
                const city = document.getElementById('city').value.trim().toLowerCase();
                const state = document.getElementById('state').value.trim().toLowerCase();

                // Mock data of distances in km from store location (example: Pune)
                const locationDistances = {
                    '411001': 10,
                    '411002': 12,
                    '411003': 8,
                    'mumbai': 150,
                    'delhi': 1400,
                    'bangalore': 850,
                    'chennai': 1200,
                    'kolkata': 1800,
                    'maharashtra': 100,
                    'karnataka': 900,
                    'delhi': 1400,
                    'tamil nadu': 1200,
                };

                if (locationDistances[zip]) return locationDistances[zip];
                if (locationDistances[city]) return locationDistances[city];
                if (locationDistances[state]) return locationDistances[state];

                // Default distance if no match found
                return 500;
            }

            // Calculate shipping cost based on weight (grams), distance (km), and state surcharge
            function calculateShipping() {
                const subtotal = displayCartItems();
                if (subtotal === 0) {
                    shippingCostElement.textContent = '0';
                    orderTotalElement.textContent = '0';
                    return 0;
                }

                const distance = calculateDistance();
                let shippingCost = 0;

                // Weight thresholds in grams and corresponding base shipping costs (example)
                if (totalWeight <= 500) {
                    shippingCost = 50;
                } else if (totalWeight <= 1000) {
                    shippingCost = 75;
                } else if (totalWeight <= 2000) {
                    shippingCost = 100;
                } else {
                    shippingCost = 150;
                }

                // Add distance-based surcharge: 1 INR per 10 km rounded up
                const distanceSurcharge = Math.ceil(distance / 10);
                shippingCost += distanceSurcharge;

                // Add state-based surcharge example
                const state = document.getElementById('state').value.trim().toLowerCase();

                // Define surcharge per state (INR)
                const stateSurchargeMap = {
                    'delhi': 20,
                    'karnataka': 15,
                    'tamil nadu': 25,
                    'maharashtra': 10,
                    'west bengal': 30,
                    // Add more states as needed
                };

                if (stateSurchargeMap[state]) {
                    shippingCost += stateSurchargeMap[state];
                }

                shippingCostElement.textContent = shippingCost.toFixed(2);

                const total = subtotal + shippingCost;
                orderTotalElement.textContent = total.toFixed(2);

                return shippingCost;
            }

            // Clear cart function after successful payment
            function clearCart() {
                localStorage.removeItem('cartItems');
                document.getElementById('cart-icon-count').textContent = '0';
            }

            // Initialize
            displayCartItems();
            calculateShipping();

            // Update cart icon count
            document.getElementById('cart-icon-count').textContent = cart.reduce((acc, item) => acc + item.quantity, 0);

            // Recalculate shipping and total when relevant fields change
            const zipCodeField = document.getElementById('zip');
            zipCodeField.addEventListener('input', calculateShipping);
            document.getElementById('city').addEventListener('input', calculateShipping);
            document.getElementById('state').addEventListener('change', calculateShipping);

            // Razorpay Integration
            checkoutForm.addEventListener('submit', function (e) {
                e.preventDefault();

                // Get form values
                const fullName = document.getElementById('fullName').value;
                const email = document.getElementById('email').value;
                const phone = document.getElementById('phone').value;
                const address = document.getElementById('address').value;
                const city = document.getElementById('city').value;
                const state = document.getElementById('state').value;
                const zipCode = document.getElementById('zip').value;
                const country = document.getElementById('country').value;

                // Calculate shipping cost fresh
                const currentShippingCost = calculateShipping();
                const totalAmountPayable = parseFloat(orderTotalElement.textContent);

                const options = {
                    key: "rzp_test_dzr0ExL25Pj8II",
                    amount: totalAmountPayable * 100,
                    currency: "INR",
                    name: "Aamoda Pickles",
                    description: "Order from Aamoda Pickles",
                    image: "logo.png",
                    handler: function (response) {
                        alert("Payment Successful! Payment ID: " + response.razorpay_payment_id);
                        clearCart();
                        window.location.href = 'index.html';
                    },
                    prefill: {
                        name: fullName,
                        email: email,
                        contact: phone
                    },
                    notes: {
                        address: address,
                        city: city,
                        state: state,
                        zip: zipCode,
                        country: country,
                        shippingCost: currentShippingCost,
                        totalWeight: totalWeight / 1000
                    },
                    theme: {
                        color: "#400607"
                    },
                    modal: {
                        ondismiss: function () {
                            alert("Payment popup was closed. If you need help, feel free to contact us.");
                        }
                    }
                };

                const rzp = new Razorpay(options);

                rzp.on('payment.failed', function (response) {
                    alert("Payment failed. Please try again.\nReason: " + response.error.description);
                });

                rzp.open();
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
